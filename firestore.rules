rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /feedback_responses/{feedback_response} {
      function validateFeedbackResponse() {
        return request.resource.data.keys().hasOnly(['page_ref', 'date', 'is_positive_feedback', 'event_description', 'suggestions', 'email']) &&
        request.resource.data['page_ref'] is string &&
        request.resource.data['page_ref'].size() < 100 &&
        request.resource.data['date'] == request.time.date() &&
        request.resource.data['is_positive_feedback'] is bool &&
        request.resource.data['event_description'] is string &&
        request.resource.data['event_description'].size() < 5000 &&
        request.resource.data['suggestions'] is string &&
        request.resource.data['suggestions'].size() < 5000 &&
        request.resource.data['email'] is string &&
        request.resource.data['email'].size() < 255;
      }
      allow create: if validateFeedbackResponse();
    }
    match /page_loads/{page_load} {
      function validatePageLoad() {
        return request.resource.data.keys().hasOnly(['qr_ref', 'date', 'page_path']) &&
        (request.resource.data['qr_ref'] == null ||
          (request.resource.data['qr_ref'] is string &&
          request.resource.data['qr_ref'].size() == 8)
        ) &&
        request.resource.data['date'] == request.time.date() &&
        request.resource.data['page_path'] is string &&
        request.resource.data['page_path'].size() < 100;
      }
      allow create: if validatePageLoad();
    }
    match /link_clicks/{link_click} {
      function validateLinkClick() {
        return request.resource.data.keys().hasOnly(['href', 'date', 'page_path']) &&
        request.resource.data['href'] is string &&
        request.resource.data['href'].size() < 500 &&
        request.resource.data['date'] == request.time.date() &&
        request.resource.data['page_path'] is string &&
        request.resource.data['page_path'].size() < 100;
      }
      allow create: if validateLinkClick();
    }
    match /poster_placements/{poster_placement} {
      function validatePosterPlacement() {
        return request.resource.data.keys().hasOnly(['qr_id', 'date', 'location']) &&
        request.resource.data['qr_id'] is string &&
        request.resource.data['qr_id'].size() == 8 &&
        request.resource.data['date'] == request.time.date() &&
        request.resource.data['location'] is latlng;
      }
      allow create: if validatePosterPlacement();
    }
  }
}
